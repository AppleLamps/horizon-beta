<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vanilla JS Image Editor</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/camanjs/4.1.2/caman.full.min.js"></script>
</head>
<body>
  <!-- Inline SVG sprite for reusable icons -->
  <svg xmlns="http://www.w3.org/2000/svg" class="sr-only-svg" aria-hidden="true" focusable="false">
    <defs>
      <symbol id="icon-file" viewBox="0 0 24 24">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M14 2v6h6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      </symbol>
      <symbol id="icon-crop" viewBox="0 0 24 24">
        <path d="M6 2v14a2 2 0 0 0 2 2h14" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M2 6h14a2 2 0 0 1 2 2v14" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      </symbol>
      <symbol id="icon-rotate-90" viewBox="0 0 24 24">
        <path d="M4 7V3L1 6l3 3V5a9 9 0 1 1-2 6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M13 19h6M19 19l-2-2M19 19l-2 2" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      </symbol>
      <symbol id="icon-flip-h" viewBox="0 0 24 24">
        <path d="M3 6l6 6-6 6V6zM21 6l-6 6 6 6V6z" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M12 4v16" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      </symbol>
      <symbol id="icon-undo" viewBox="0 0 24 24">
        <path d="M9 14H5l4-4M5 10a9 9 0 1 1 3 6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      </symbol>
      <symbol id="icon-redo" viewBox="0 0 24 24">
        <path d="M15 14h4l-4-4M19 10a9 9 0 1 0-3 6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      </symbol>
      <symbol id="icon-save" viewBox="0 0 24 24">
        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M17 21v-8H7v8M7 3v5h7" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      </symbol>
      <symbol id="icon-image" viewBox="0 0 24 24">
        <path d="M3 4h18v16H3z" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M8 13l3-3 5 6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        <circle cx="8.5" cy="8.5" r="1.5" fill="currentColor"/>
      </symbol>
    </defs>
  </svg>

  <header class="app-header">
    <h1>Vanilla Image Editor</h1>
  </header>

  <main class="app-grid">
    <aside class="toolbar" id="toolbar" aria-label="Image editing toolbar" role="region">
      <div class="group" role="group" aria-labelledby="grp-load-label">
        <h3 id="grp-load-label" class="sr-only">Load</h3>
        <label class="file-label" title="Load an image from your device">
          <input id="fileInput" type="file" accept="image/*" />
          <span>
            <svg class="icon" aria-hidden="true"><use href="#icon-file"></use></svg>
            <span>Load Image</span>
          </span>
        </label>
      </div>

      <div class="group" role="group" aria-labelledby="grp-tools-label">
        <h3 id="grp-tools-label" class="sr-only">Tools</h3>
        <button id="cropBtn" class="tool-btn" title="Crop (drag to select)">
          <svg class="icon" aria-hidden="true"><use href="#icon-crop"></use></svg>
          <span>Crop</span>
        </button>
        <button id="rotateBtn" class="tool-btn" title="Rotate 90° clockwise">
          <svg class="icon" aria-hidden="true"><use href="#icon-rotate-90"></use></svg>
          <span>Rotate 90°</span>
        </button>
        <button id="flipHBtn" class="tool-btn" title="Flip horizontally">
          <svg class="icon" aria-hidden="true"><use href="#icon-flip-h"></use></svg>
          <span>Flip H</span>
        </button>
        <button id="textBtn" class="tool-btn">Text</button>
        <button id="drawBtn" class="tool-btn">Draw</button>
      </div>

      <div class="group sliders" role="group" aria-labelledby="grp-adjust-label">
        <h3 id="grp-adjust-label" class="sr-only">Adjustments</h3>
        <label for="brightness">Brightness</label>
        <input id="brightness" type="range" min="-100" max="100" value="0" />
        <label for="contrast">Contrast</label>
        <input id="contrast" type="range" min="-100" max="100" value="0" />
        <label for="saturation">Saturation</label>
        <input id="saturation" type="range" min="-100" max="100" value="0" />
        <label for="vibrance">Vibrance</label>
        <input id="vibrance" type="range" min="-100" max="100" value="0" />
        <button id="resetAdjustBtn" class="tool-btn">Reset Adjustments</button>
      </div>

      <div class="group" role="group" aria-labelledby="grp-filters-label">
        <h3 id="grp-filters-label" class="sr-only">Filters</h3>
        <button id="vintageBtn" class="tool-btn">Vintage</button>
        <button id="lomoBtn" class="tool-btn">Lomo</button>
        <button id="sepiaBtn" class="tool-btn">Sepia</button>
        <button id="nostalgiaBtn" class="tool-btn">Nostalgia</button>
      </div>

      <div class="group" role="group" aria-labelledby="grp-history-label">
        <h3 id="grp-history-label" class="sr-only">History</h3>
        <button id="undoBtn" class="tool-btn" title="Undo (Ctrl+Z)" disabled>
          <svg class="icon" aria-hidden="true"><use href="#icon-undo"></use></svg>
          <span>Undo</span>
        </button>
        <button id="redoBtn" class="tool-btn" title="Redo (Ctrl+Y)" disabled>
          <svg class="icon" aria-hidden="true"><use href="#icon-redo"></use></svg>
          <span>Redo</span>
        </button>
        <div class="history-strip-controls">
          <label for="histSize" class="sr-only">Thumbnail size</label>
          <select id="histSize" title="Thumbnail size">
            <option value="64">Small</option>
            <option value="96" selected>Medium</option>
            <option value="128">Large</option>
          </select>
        </div>
      </div>

      <div id="textControls" class="group sliders is-hidden" role="group" aria-labelledby="grp-text-label">
        <h3 id="grp-text-label" class="sr-only">Text Tool</h3>
        <label for="textInput">Text:</label>
        <input id="textInput" type="text" placeholder="Enter text..."/>
        <label for="textColor">Color:</label>
        <input id="textColor" type="color" value="#ffffff"/>
        <label for="fontSize">Font Size:</label>
        <input id="fontSize" type="number" min="10" max="200" value="48" />
        <button id="addTextBtn" class="tool-btn" type="button">Add</button>
        <!-- Apply button is created dynamically in app.js to keep markup minimal -->
      </div>

      <div id="brushControls" class="group sliders is-hidden" role="group" aria-labelledby="grp-brush-label">
        <h3 id="grp-brush-label" class="sr-only">Brush Tool</h3>
        <label for="brushColor">Color:</label>
        <input id="brushColor" type="color" value="#ff0000"/>
        <label for="brushSize">Size:</label>
        <input id="brushSize" type="range" min="1" max="100" value="5" />
      </div>

      <div class="group" role="group" aria-labelledby="grp-export-label">
        <h3 id="grp-export-label" class="sr-only">Export</h3>
        <button id="saveBtn" class="primary-btn" title="Download as PNG" type="button">
          <svg class="icon" aria-hidden="true"><use href="#icon-save"></use></svg>
          <span>Save PNG</span>
        </button>
        <button id="exportBtn" class="primary-btn" title="Export as JPEG/WebP" type="button">
          <svg class="icon" aria-hidden="true"><use href="#icon-image"></use></svg>
          <span>Export…</span>
        </button>
      </div>
    </aside>

    <section class="canvas-area" aria-label="Canvas area">
      <div class="canvas-wrapper" id="canvasWrapper">
        <canvas id="canvas" role="img" tabindex="0" aria-label="Image canvas" aria-describedby="hint"></canvas>
        <canvas id="text-layer" class="edit-layer" aria-hidden="true"></canvas>
        <canvas id="draw-layer" class="edit-layer" aria-hidden="true"></canvas>
        <canvas id="overlay" aria-hidden="true"></canvas>
      </div>
      <div id="historyStrip" class="history-strip" aria-label="History" role="listbox" tabindex="0"></div>
      <p class="hint" id="hint">Drop or load an image to begin. No uploads, all in-browser.</p>
    </section>
    <aside class="layers-panel" id="layersPanel" aria-label="Layers">
      <h3>Layers</h3>
      <ul id="layerList">
      </ul>
    </aside>
  </main>

  <footer class="app-footer">
    <small><svg class="icon" aria-hidden="true"><use href="#icon-save"></use></svg> All in-browser. No uploads. Pure HTML/CSS/JS.</small>
  </footer>

  <!-- Toast container -->
  <div id="toasts" class="toasts" role="status" aria-live="polite" aria-relevant="additions text"></div>

  <!-- Export modal -->
  <dialog id="exportDialog">
    <form method="dialog" class="export-form">
      <h3>Export Image</h3>
      <div class="row">
        <label for="format">Format</label>
        <select id="format">
          <option value="png">PNG</option>
          <option value="jpeg">JPEG</option>
          <option value="webp">WebP</option>
        </select>
      </div>
      <div class="row">
        <label for="quality">Quality</label>
        <input id="quality" type="range" min="0.1" max="1" step="0.05" value="0.85" />
        <span id="qualityVal">0.85</span>
      </div>
      <div class="row">
        <label for="scale">Scale</label>
        <input id="scale" type="number" min="10" max="400" step="10" value="100" />%
      </div>
      <menu>
        <button id="cancelExport" value="cancel" type="reset">Cancel</button>
        <button id="confirmExport" value="default">Export</button>
      </menu>
    </form>
  </dialog>

  <script type="module" src="app.js"></script>
</body>
</html>
